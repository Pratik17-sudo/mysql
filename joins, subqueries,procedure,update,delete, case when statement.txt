

Task: Find the best score per course for a student.
For a given student:
Show only the highest score per course




mysql> select  c.course_id,c.course_name, max(score) as total_score from enrollments e join students s on s.student_id=e.student_id join courses c on c.course_id=e.course_id where s.student_id=1 group by c.course_id, c.course_name;
+-----------+------------------+-------------+
| course_id | course_name      | total_score |
+-----------+------------------+-------------+
|       101 | database systems |       78.50 |
|       102 | data structures  |       88.00 |
+-----------+------------------+-------------+
2 rows in set (0.001 sec)


_______________________________________________________

Task: Use subqueries with dates.
For a given student:
Show only the latest attempt per course
Based on completed_at


mysql> select e.*
    -> from enrollments e
    -> where e.student_id = 1
    -> and e.completed_at = (
    ->     select max(e2.completed_at)
    ->     from enrollments e2
    ->     where e2.student_id = e.student_id
    ->       and e2.course_id = e.course_id
    -> );
+---------------+------------+-----------+-------+---------------------+
| enrollment_id | student_id | course_id | score | completed_at        |
+---------------+------------+-----------+-------+---------------------+
|             2 |          1 |       101 | 78.50 | 2024-03-10 11:30:00 |
|             3 |          1 |       102 | 88.00 | 2024-02-20 09:00:00 |
+---------------+------------+-----------+-------+---------------------+
2 rows in set (0.001 sec)

__________________________________________________________________


Task- Identify top performers.
For each course:
Display:
Course name
Highest score achieved
Student name who achieved it



mysql> select c.course_name, e.score as max_score, s.name
    -> from enrollments e
    -> join courses c on c.course_id = e.course_id
    -> join students s on s.student_id = e.student_id
    -> where e.score = (
    ->     select max(e2.score)
    ->     from enrollments e2
    ->     where e2.course_id = e.course_id
    -> );
+-------------------+-----------+----------------+
| course_name       | max_score | name           |
+-------------------+-----------+----------------+
| database systems  |     78.50 | pratik dahat   |
| data structures   |     88.00 | pratik dahat   |
| web development   |     89.00 | parth deshmukh |
| operating systems |     91.00 | div gabahane   |
+-------------------+-----------+----------------+
4 rows in set (0.001 sec)

___________________________________________________________________________


Tasks: Basic UPDATE Operations
Update a student’s email address.
Update a course name (e.g., “Intro to Java” → “Java Fundamentals”).
Update the contact number for a user.
Constraints

Use WHERE clause properly.
Ensure no other rows are affected.






mysql> update students set email="pratikdahatvignet@gmail.com" where student_id=1;
Query OK, 1 row affected (0.007 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select * from students where student_id=1;
+------------+--------------+-----------------------------+
| student_id | name         | email                       |
+------------+--------------+-----------------------------+
|          1 | pratik dahat | pratikdahatvignet@gmail.com |
+------------+--------------+-----------------------------+
1 row in set (0.000 sec)

-----------------------------------------------------------



mysql> update courses set course_name="Advances DS" where course_id=102;
Query OK, 1 row affected (0.003 sec)
Rows matched: 1  Changed: 1  Warnings: 0


mysql> select * from courses where course_id=102;
+-----------+-------------+
| course_id | course_name |
+-----------+-------------+
|       102 | Advances DS |
+-----------+-------------+
1 row in set (0.000 sec)

________________________________________________________________________________


Tasks- Conditional UPDATE


Increase scores by 5 points for all enrollments of a specific course.

mysql> update enrollments set score=score+5 where course_id=101;
Query OK, 4 rows affected (0.002 sec)
Rows matched: 4  Changed: 4  Warnings: 0


-------------------------------------------------------




Reduce scores by 10% for enrollments before a specific date.

mysql> update enrollments set score = score * 0.9 where completed_at < '2024-03-01';
Query OK, 6 rows affected (0.001 sec)
Rows matched: 6  Changed: 6  Warnings: 0


------------------------------------------------------------------


Set score to NULL where score is negative or greater than 85;

mysql> update enrollments set score = null where score < 0 or score > 85;
Query OK, 2 rows affected (0.001 sec)
Rows matched: 2  Changed: 2  Warnings: 0



mysql> select * from enrollments;
+---------------+------------+-----------+-------+---------------------+
| enrollment_id | student_id | course_id | score | completed_at        |
+---------------+------------+-----------+-------+---------------------+
|             1 |          1 |       101 | 45.00 | 2024-01-15 10:00:00 |
|             2 |          1 |       101 | 83.50 | 2024-03-10 11:30:00 |
|             3 |          1 |       102 | 79.20 | 2024-02-20 09:00:00 |
|             4 |          2 |       103 | 49.50 | 2024-01-25 14:00:00 |
|             5 |          2 |       103 | 72.00 | 2024-04-12 16:00:00 |
|             6 |          2 |       104 | 81.00 | 2024-03-05 12:00:00 |
|             7 |          3 |       101 | 58.50 | 2024-02-01 10:30:00 |
|             8 |          3 |       102 | 44.10 | 2024-02-18 15:00:00 |
|             9 |          3 |       102 | 85.00 | 2024-05-01 09:45:00 |
|            10 |          4 |       104 |  NULL | 2024-03-22 13:15:00 |
|            11 |          4 |       101 | 72.00 | 2024-04-18 10:10:00 |
|            12 |          5 |       103 | 65.70 | 2024-01-30 11:00:00 |
|            13 |          5 |       103 |  NULL | 2024-05-20 14:20:00 |
|            14 |          5 |       102 | 77.00 | 2024-03-28 09:30:00 |
+---------------+------------+-----------+-------+---------------------+
14 rows in set (0.000 sec)


_____________________________________________________________________________


Tasks- UPDATE with JOIN

Update all enrollments for a given student to mark them as reviewed.



mysql> alter table enrollments add column reviewed tinyint(1) default 0;
Query OK, 0 rows affected, 1 warning (0.006 sec)
Records: 0  Duplicates: 0  Warnings: 1





mysql> update enrollments e join students s on e.student_id = s.student_id set e.reviewed=1 where s.student_id = 3;
Query OK, 3 rows affected (0.001 sec)
Rows matched: 3  Changed: 3  Warnings: 0




mysql> select * from enrollments where student_id=3;
+---------------+------------+-----------+-------+---------------------+---------------+----------+
| enrollment_id | student_id | course_id | score | completed_at        | course_status | reviewed |
+---------------+------------+-----------+-------+---------------------+---------------+----------+
|             7 |          3 |       101 | 58.50 | 2024-02-01 10:30:00 | COMPLETED     |        1 |
|             8 |          3 |       102 | 44.10 | 2024-02-18 15:00:00 | COMPLETED     |        1 |
|             9 |          3 |       102 | 85.00 | 2024-05-01 09:45:00 | COMPLETED     |        1 |
+---------------+------------+-----------+-------+---------------------+---------------+----------+
3 rows in set (0.000 sec)




-------------------------------------------------------------------------------
Add a column course_status and update it to:
COMPLETED if completed_at is not null
IN_PROGRESS otherwise


mysql> alter table enrollments add column course_status varchar(20);
Query OK, 0 rows affected (0.020 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> update enrollments
    -> set course_status = case
    ->     when completed_at is not null then 'COMPLETED'
    ->     else 'IN_PROGRESS'
    -> end;
Query OK, 14 rows affected (0.002 sec)
Rows matched: 14  Changed: 14  Warnings: 0


mysql> select * from enrollments;
+---------------+------------+-----------+-------+---------------------+---------------+
| enrollment_id | student_id | course_id | score | completed_at        | course_status |
+---------------+------------+-----------+-------+---------------------+---------------+
|             1 |          1 |       101 | 45.00 | 2024-01-15 10:00:00 | COMPLETED     |
|             2 |          1 |       101 | 83.50 | 2024-03-10 11:30:00 | COMPLETED     |
|             3 |          1 |       102 | 79.20 | 2024-02-20 09:00:00 | COMPLETED     |
|             4 |          2 |       103 | 49.50 | 2024-01-25 14:00:00 | COMPLETED     |
|             5 |          2 |       103 | 72.00 | 2024-04-12 16:00:00 | COMPLETED     |
|             6 |          2 |       104 | 81.00 | 2024-03-05 12:00:00 | COMPLETED     |
|             7 |          3 |       101 | 58.50 | 2024-02-01 10:30:00 | COMPLETED     |
|             8 |          3 |       102 | 44.10 | 2024-02-18 15:00:00 | COMPLETED     |
|             9 |          3 |       102 | 85.00 | 2024-05-01 09:45:00 | COMPLETED     |
|            10 |          4 |       104 |  NULL | 2024-03-22 13:15:00 | COMPLETED     |
|            11 |          4 |       101 | 72.00 | 2024-04-18 10:10:00 | COMPLETED     |
|            12 |          5 |       103 | 65.70 | 2024-01-30 11:00:00 | COMPLETED     |
|            13 |          5 |       103 |  NULL | 2024-05-20 14:20:00 | COMPLETED     |
|            14 |          5 |       102 | 77.00 | 2024-03-28 09:30:00 | COMPLETED     |
+---------------+------------+-----------+-------+---------------------+---------------+
14 rows in set (0.000 sec)

______________________________________________________________________________________________________





Tasks: Safe DELETE (Single Table)
Delete a student record only if the student has no enrollments.

mysql> create procedure delete_student_if_no_enrollment(in p_student_id int)
    -> begin
    ->     if not exists (
    ->         select 1 from enrollments
    ->         where student_id = p_student_id
    ->     ) then
    ->         delete from students
    ->         where student_id = p_student_id;
    ->     end if;
    -> end //
Query OK, 0 rows affected (0.003 sec)


mysql> call delete_student_if_no_enrollment(2);
Query OK, 0 rows affected (0.002 sec)


mysql> call delete_student_if_no_enrollment(6);
Query OK, 1 row affected (0.001 sec)

-----------------------------------------------------------

Delete all enrollments older than 3 years.

mysql> select *
    -> from enrollments
    -> where completed_at < date_sub(now(), interval 2 year);
+---------------+------------+-----------+-------+---------------------+---------------+----------+
| enrollment_id | student_id | course_id | score | completed_at        | course_status | reviewed |
+---------------+------------+-----------+-------+---------------------+---------------+----------+
|             1 |          1 |       101 | 45.00 | 2024-01-15 10:00:00 | COMPLETED     |        0 |
|             3 |          1 |       102 | 79.20 | 2024-02-20 09:00:00 | COMPLETED     |        0 |
|             4 |          2 |       103 | 49.50 | 2024-01-25 14:00:00 | COMPLETED     |        0 |
|             7 |          3 |       101 | 58.50 | 2024-02-01 10:30:00 | COMPLETED     |        1 |
|             8 |          3 |       102 | 44.10 | 2024-02-18 15:00:00 | COMPLETED     |        1 |
|            12 |          5 |       103 | 65.70 | 2024-01-30 11:00:00 | COMPLETED     |        0 |
+---------------+------------+-----------+-------+---------------------+---------------+----------+
6 rows in set (0.000 sec)

mysql> delete from enrollments
    -> where completed_at < date_sub(now(), interval 2 year);
Query OK, 6 rows affected (0.001 sec)

----------------------------------------------------------------



Delete enrollments with scores below 40.

mysql> select * from enrollments where score<75;
+---------------+------------+-----------+-------+---------------------+---------------+----------+
| enrollment_id | student_id | course_id | score | completed_at        | course_status | reviewed |
+---------------+------------+-----------+-------+---------------------+---------------+----------+
|             5 |          2 |       103 | 72.00 | 2024-04-12 16:00:00 | COMPLETED     |        0 |
|            11 |          4 |       101 | 72.00 | 2024-04-18 10:10:00 | COMPLETED     |        0 |
+---------------+------------+-----------+-------+---------------------+---------------+----------+
2 rows in set (0.000 sec)

mysql> delete from enrollments
    -> where enrollment_id in (
    ->     select enrollment_id
    ->     from (select enrollment_id from enrollments where score < 75) as temp
    -> );
Query OK, 2 rows affected (0.001 sec)

mysql> select * from enrollments where score<75;
Empty set (0.000 sec)

---------------------------------------------------------------

Delete duplicate user records.
mysql> insert into students values(6,'Prajwal','prajwal12@gmail.com');
Query OK, 1 row affected (0.001 sec)
mysql> insert into students values(7,'Prajwal','prajwal112@gmail.com');
Query OK, 1 row affected (0.001 sec)


mysql> select name, count(*) from students group by name having count(*)>1;
+---------+----------+
| name    | count(*) |
+---------+----------+
| Prajwal |        2 |
+---------+----------+
1 row in set (0.000 sec)


mysql> delete from students
    -> where name in (
    ->     select name
    ->     from (
    ->         select name
    ->         from students
    ->         group by name
    ->         having count(*) > 1
    ->     ) as temp
    -> );
Query OK, 2 rows affected (0.001 sec)


------------------------------------------------------------

Delete courses that have never been taken by any student.

mysql> insert into courses values(105,'Python');
Query OK, 1 row affected (0.002 sec)

mysql> select * from courses;
+-----------+-------------------+
| course_id | course_name       |
+-----------+-------------------+
|       101 | database systems  |
|       102 | Advances DS       |
|       103 | web development   |
|       104 | operating systems |
|       105 | Python            |
+-----------+-------------------+
5 rows in set (0.000 sec)




mysql> select *
    -> from courses
    -> where course_id not in (
    ->     select course_id from enrollments
    -> );
+-----------+-------------+
| course_id | course_name |
+-----------+-------------+
|       105 | Python      |
+-----------+-------------+
1 row in set (0.000 sec)



mysql> delete from courses
    -> where course_id in (
    ->     select course_id
    ->     from (select course_id from courses where course_id not in (select course_id from enrollments)) as temp
    -> );
Query OK, 1 row affected (0.002 sec)



